<!-- Manual/EMDR-clinical-scripts.html -->
<!-- Dynamic script tool - fully localized & stable (with bilingual PC dropdown) -->

<style>
  :root {
    --toggle-bg: var(--border);
    --toggle-fg: var(--muted);
    --toggle-bg-active: var(--accent);
    --toggle-fg-active: var(--accent-contrast);
    --table-border-color: var(--border);
    --clinician-text-color: #0000FF;
    --alt-section-bg: #FFF8E4;
  }
  body.dark {
    --toggle-bg: var(--border);
    --toggle-fg: var(--muted);
    --table-border-color: var(--border);
    --clinician-text-color: #60a5fa;
    --alt-section-bg: rgba(255, 248, 228, 0.04);
  }

  .script-tool-section {
    margin-bottom: 1rem;
    padding: 1.5rem var(--pad);
    border-bottom: 1px solid var(--border);
    border-radius: 8px;
  }
  #manual-content > div > .script-tool-section:nth-of-type(even) { background-color: var(--alt-section-bg); }
  .script-tool-section:last-of-type { border-bottom: none; margin-bottom: 0; }

  #tool-main-heading{
    margin-bottom: 1.5rem;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid var(--border);
    font-size: clamp(1.5rem, 2.2vw, 1.8rem);
    color: var(--fg);
    text-align: center;
  }

  .script-step{ margin-bottom: 1.5rem; }
  .script-step:last-child{ margin-bottom: 0; }

  .script-step h3{ font-size: 1.25rem; margin-bottom: .25rem; color: var(--fg); }

  .script-step h4{
    font-size: 1rem;
    font-style: italic;
    color: var(--muted);
    margin-bottom: .5rem;
    margin-top: 1rem;
    font-weight: normal;
  }

  .script-line{ margin-bottom: .5rem; line-height: 1.7; color: var(--muted); }
  .script-line.clinician em{ color: var(--clinician-text-color); font-weight: bold; font-style: italic; }
  .script-line strong{ color: var(--accent); font-weight: 600; }

  .input-wrapper{
    margin-top: .75rem;
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
    border-left: 3px solid var(--accent);
    background-color: rgba(var(--accent-rgb, 30, 64, 175), .05);
    padding: .75rem .75rem .75rem 1.5rem;
    border-radius: 0 4px 4px 0;
  }
  .input-wrapper label{ display:block; font-weight:600; color: var(--fg); margin-bottom: .5rem; font-size:.9rem; }

  .input-wrapper input[type="text"],
  .input-wrapper textarea,
  .input-wrapper select{
    width:100%; padding:.6rem; font-size:.95rem; background:var(--card); color:var(--fg);
    border:1px solid var(--border); border-radius:.4rem; font-family:inherit; box-shadow: inset 0 1px 2px rgba(0,0,0,.05);
  }
  .input-wrapper input[type="text"]:focus,
  .input-wrapper textarea:focus,
  .input-wrapper select:focus{ border-color:var(--accent); outline:1px solid var(--accent); }
  .input-wrapper textarea{ min-height:60px; resize:vertical; }
  .input-wrapper select{
    -webkit-appearance:none; appearance:none;
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
    background-repeat:no-repeat; background-position:right .75rem center; background-size:16px 16px; cursor:pointer;
  }
  body.dark .input-wrapper select{
    background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='%23e5e7eb' viewBox='0 0 16 16'%3E%3Cpath fill-rule='evenodd' d='M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z'/%3E%3C/svg%3E");
  }
  .input-wrapper .other-input{ margin-top:.5rem; }

  .output{
    font-weight:bold; color:var(--accent);
    background-color: rgba(var(--accent-rgb, 30, 64, 175), .08);
    padding:.1em .3em; border-radius:3px; margin:0 .1em; font-style:normal;
  }
  .output.placeholder{ font-style:italic; font-weight:normal; color:var(--muted); background:transparent; padding:0; }

  .response-table{ width:100%; border-collapse:collapse; margin-top:1rem; margin-bottom:1.5rem; }
  .response-table th,.response-table td{ border:1px solid var(--table-border-color); padding:.75rem; text-align:left; vertical-align:top; }
  .response-table th{ background-color: rgba(var(--accent-rgb,30,64,175),.05); font-weight:600; color:var(--fg); width:50%; }
  .response-table td .script-line{ margin-bottom:.5rem; }
  .response-table td .script-line:last-child{ margin-bottom:0; }

  .collapsible-trigger{
    display:flex; align-items:center; gap:.5rem; cursor:pointer; padding:.25rem 0; margin-top:.5rem; margin-bottom:1rem; user-select:none;
  }
  .collapsible-trigger input[type="checkbox"]{ margin:0; width:1rem; height:1rem; cursor:pointer; flex-shrink:0; }
  .collapsible-trigger label{ font-weight:600; font-size:.95rem; color:var(--muted); cursor:pointer; transition:color .2s; line-height:1.4; }
  .collapsible-trigger input[type="checkbox"]:checked + label { color:var(--fg); }
  .collapsible-trigger label::before{
    content:'▶'; display:inline-block; margin-right:.4em; font-size:.7em; transition: transform .3s ease-out; color:var(--muted);
  }
  .collapsible-trigger input[type="checkbox"]:checked + label::before{ transform: rotate(90deg); color:var(--accent); }

  .collapsible-content{
    max-height:0; overflow:hidden; transition:max-height .4s ease-out, padding-top .4s ease-out, margin-top .4s ease-out, border-left-color .4s ease-out;
    border-left:3px solid transparent; padding-left:1.5rem; margin-left:0; padding-top:0; margin-top:0;
  }
  .collapsible-content.is-expanded{
    max-height:2500px; transition:max-height .6s ease-in, padding-top .6s ease-in, margin-top .6s ease-in, border-left-color .6s ease-in;
    padding-top:.5rem; margin-top:0; border-left-color:var(--accent);
  }

  #copy-section{ margin-top:2rem; padding-top:1.5rem; border-top:1px solid var(--border); text-align:right; }
  #copy-message{ margin-top:.5rem; font-size:.9rem; color:var(--accent); height:1.2em; text-align:right; margin-bottom:.5rem; }
  .copy-button{ padding:.55rem 1rem; font-weight:600; border-radius:.625rem; cursor:pointer; background:var(--accent); color:var(--accent-contrast); border:1px solid var(--accent); }
  .copy-button.copied{ background:#10B981; border-color:#059669; }

  body { --accent-rgb: 30, 64, 175; }
  body.dark { --accent-rgb: 59, 130, 246; }
</style>

<div>
  <h1 id="tool-main-heading"
      data-en="PROCEDURAL STEPS FOR DEVELOPING FUTURE TEMPLATES"
      data-uk="ПРОЦЕДУРНІ КРОКИ ДЛЯ РОЗРОБКИ МАЙБУТНІХ ШАБЛОНІВ">
    PROCEDURAL STEPS FOR DEVELOPING FUTURE TEMPLATES
  </h1>

  <!-- Introduction -->
  <div class="script-tool-section" id="introduction-section">
    <div class="script-step">
      <h3 data-en="Introduction" data-uk="Вступ">Introduction</h3>
      <h4 data-en="Clinician Note:" data-uk="Примітка для клініциста:">Clinician Note:</h4>
      <p class="script-line"
         data-en="This script adapts the standard EMDR Future Template for use with BRAVEMIND Ukraine VR. Ensure client comfort and readiness for VR before proceeding. Use tactile/auditory BLS primarily. Monitor for dissociation."
         data-uk="Цей скрипт адаптує стандартний Шаблон Майбутнього EMDR для використання з BRAVEMIND Ukraine VR. Переконайтеся в комфорті та готовності клієнта до VR перед початком. Використовуйте переважно тактильний/слуховий BLS. Слідкуйте за дисоціацією.">
        This script adapts the standard EMDR Future Template for use with BRAVEMIND Ukraine VR. Ensure client comfort and readiness for VR before proceeding. Use tactile/auditory BLS primarily. Monitor for dissociation.
      </p>

      <div class="input-wrapper">
        <label for="present-trigger"
               data-en="Present Trigger(s) (Reprocessed)"
               data-uk="Поточний(і) тригер(и) (Перероблений)">Present Trigger(s) (Reprocessed)</label>
        <textarea id="present-trigger" rows="2"
          data-en-placeholder="e.g., Loud noises, specific smells, news reports..."
          data-uk-placeholder="напр., Гучні звуки, специфічні запахи, теленовини…"
          placeholder="e.g., Loud noises, specific smells, news reports..."></textarea>
      </div>

      <div class="input-wrapper">
        <label for="positive-cognition"
               data-en="Positive Cognition (PC) from Present Trigger"
               data-uk="Позитивне переконання (ПП) з поточного тригера">Positive Cognition (PC) from Present Trigger</label>
        <input type="text" id="positive-cognition"
          data-en-placeholder="e.g., I am safe now, I did the best I could..."
          data-uk-placeholder="напр., Я зараз у безпеці, Я зробив(ла) все можливе…"
          placeholder="e.g., I am safe now, I did the best I could...">
      </div>

      <p class="script-line clinician"
         data-en="<em>“You have just completed work on a present trigger related to <span class='output placeholder' data-input-id='present-trigger'>(Specify reprocessed present trigger)</span> and came to that positive belief of '<span class='output placeholder' data-input-id='positive-cognition'>(Specify PC from present trigger)</span>'.”</em>"
         data-uk="<em>«Ви щойно завершили роботу над теперішнім тригером, пов’язаним з <span class='output placeholder' data-input-id='present-trigger'>(Вкажіть перероблений теперішній тригер)</span>, і дійшли до позитивного переконання '<span class='output placeholder' data-input-id='positive-cognition'>(Вкажіть ПП з теперішнього тригера)</span>'».</em>">
        <em>“You have just completed work on a present trigger related to
          <span class="output placeholder" data-input-id="present-trigger">(Specify reprocessed present trigger)</span>
          and came to that positive belief of '<span class="output placeholder" data-input-id="positive-cognition">(Specify PC from present trigger)</span>'.”</em>
      </p>

      <p class="script-line clinician"
         data-en="<em>“Now, we are going to use virtual reality to imagine a future scenario and develop a template. Later, we might introduce some challenging scenarios within this environment. These could include things relevant to your experience. What are your thoughts? How do you feel about using this approach?”</em>"
         data-uk="<em>«Тепер ми використаємо віртуальну реальність, щоб уявити майбутній сценарій і розробити шаблон. Пізніше ми можемо ввести деякі складні сценарії в цьому середовищі. Вони можуть включати речі, що стосуються вашого досвіду. Які ваші думки? Як ви ставитеся до використання цього підходу?»</em>">
        <em>“Now, we are going to use virtual reality to imagine a future scenario and develop a template. Later, we might introduce some challenging scenarios within this environment. These could include things relevant to your experience. What are your thoughts? How do you feel about using this approach?”</em>
      </p>
    </div>
  </div>

  <div class="script-tool-section" id="step1-section">
    <div class="script-step">
      <h3 data-en="Step 1: Identify Desired Outcome" data-uk="Крок 1: Визначте бажаний результат">Step 1: Identify Desired Outcome</h3>
      <h4 data-en="Clinician Note:" data-uk="Примітка для клініциста:">Clinician Note:</h4>
      <p class="script-line"
         data-en="Identify future situation (similar to reprocessed trigger) where adaptive response is needed. Ensure client has necessary skills."
         data-uk="Визначте майбутню ситуацію (схожу на перероблений тригер), де потрібна адаптивна реакція. Переконайтеся, що клієнт має необхідні навички.">
        Identify future situation (similar to reprocessed trigger) where adaptive response is needed. Ensure client has necessary skills.
      </p>

      <p class="script-line clinician" data-en="<em>“Let’s get you set up with the VR headset.”</em>" data-uk="<em>«Давайте налаштуємо вам VR-шолом».</em>"><em>“Let’s get you set up with the VR headset.”</em></p>
      <p class="script-line" data-en="[Give client moments to familiarize.]" data-uk="[Дайте клієнту час ознайомитися.]">[Give client moments to familiarize.]</p>

      <p class="script-line clinician"
         data-en="<em>“How are you feeling with the equipment on? Do you feel any motion sickness? Does everything feel comfortable? Do you feel any tension, tightness or unusual sensation?”</em> (If yes, ask: <em>“Where in your body do you feel that?”</em>)"
         data-uk="<em>«Як ви почуваєтеся з обладнанням? Чи відчуваєте ви захитування? Чи все зручно? Чи відчувате ви напругу, стиснення чи незвичні відчуття?»</em> (Якщо так, запитайте: <em>«Де в тілі ви це відчуваєте?»</em>)">
        <em>“How are you feeling with the equipment on? Do you feel any motion sickness? Does everything feel comfortable? Do you feel any tension, tightness or unusual sensation?”</em> (If yes, ask: <em>“Where in your body do you feel that?”</em>)
      </p>

      <p class="script-line clinician"
         data-en="<em>“What is a future situation similar to what you might encounter, maybe related to <span class='output placeholder' data-input-id='present-trigger'>(Specify reprocessed present trigger)</span>, where you'd like to respond differently?”</em>"
         data-uk="<em>«Яка майбутня ситуація, схожа на те, з чим ви можете зіткнутися, можливо, пов'язана з <span class='output placeholder' data-input-id='present-trigger'>(Вкажіть перероблений теперішній тригер)</span>, де б ви хотіли реагувати інакше?»</em>">
        <em>“What is a future situation similar to what you might encounter, maybe related to
          <span class="output placeholder" data-input-id="present-trigger">(Specify reprocessed present trigger)</span>, where you'd like to respond differently?”</em>
      </p>

      <div class="input-wrapper">
        <label for="future-situation" data-en="Future Situation / Scenario" data-uk="Майбутня ситуація / Сценарій">Future Situation / Scenario</label>
        <input type="text" id="future-situation"
          data-en-placeholder="e.g., Going to a crowded place, Watching fireworks..."
          data-uk-placeholder="напр., Похід у людне місце, Перегляд феєрверків…"
          placeholder="e.g., Going to a crowded place, Watching fireworks...">
      </div>

      <p class="script-line clinician"
         data-en="<em>“Let's focus on <span class='output placeholder' data-input-id='future-situation'>(Specify future situation)</span>.”</em>"
         data-uk="<em>«Давайте зосередимося на <span class='output placeholder' data-input-id='future-situation'>(Вкажіть майбутню ситуацію)</span>».</em>">
        <em>“Let's focus on <span class="output placeholder" data-input-id="future-situation">(Specify future situation)</span>.”</em>
      </p>

      <p class="script-line clinician"
         data-en="<em>“Do the words '<span class='output placeholder' data-input-id='positive-cognition'>(Specify PC from present trigger)</span>' fit for how you want to think about yourself in that future situation <span class='output placeholder' data-input-id='future-situation'>(Specify future situation)</span>?”</em>"
         data-uk="<em>«Чи підходять слова '<span class='output placeholder' data-input-id='positive-cognition'>(Вкажіть ПП з теперішнього тригера)</span>' для того, як ви хочете думати про себе в тій майбутній ситуації <span class='output placeholder' data-input-id='future-situation'>(Вкажіть майбутню ситуацію)</span>?»</em>">
        <em>“Do the words '<span class="output placeholder" data-input-id="positive-cognition">(Specify PC from present trigger)</span>' fit for how you want to think about yourself in that future situation <span class="output placeholder" data-input-id="future-situation">(Specify future situation)</span>?”</em>
      </p>

      <div class="input-wrapper">
        <label for="pc-status" data-en="PC for Future Situation" data-uk="ПП для майбутньої ситуації">PC for Future Situation</label>
        <select id="pc-status">
          <option value="keep" data-en="Yes, keep PC from Present Trigger" data-uk="Так, залишити ПП з поточного тригера">Yes, keep PC from Present Trigger</option>
          <option value="new" data-en="No, identify New Preferred PC for Future" data-uk="Ні, визначити нове бажане ПП для майбутнього">No, identify New Preferred PC for Future</option>
        </select>
      </div>

      <div class="input-wrapper" id="new-pc-input-group" style="display:none;">
        <p class="script-line clinician"
           data-en="<em>“Okay, what words would fit? What would you prefer to believe about yourself when facing <span class='output placeholder' data-input-id='future-situation'>(Specify future situation)</span>?”</em>"
           data-uk="<em>«Добре, які слова підійшли б? Що б ви воліли вірити про себе, стикаючись з <span class='output placeholder' data-input-id='future-situation'>(Вкажіть майбутню ситуацію)</span>?»</em>">
          <em>“Okay, what words would fit? What would you prefer to believe about yourself when facing <span class="output placeholder" data-input-id="future-situation">(Specify future situation)</span>?”</em>
        </p>

        <label for="new-positive-cognition-select" data-en="New Preferred PC" data-uk="Нове бажане ПП">New Preferred PC</label>
        <select id="new-positive-cognition-select"></select>

        <input type="text" id="new-positive-cognition-other" class="other-input"
          data-en-placeholder="Enter custom new PC"
          data-uk-placeholder="Введіть власне нове ПП"
          placeholder="Enter custom new PC"
          style="display:none;">
      </div>

      <p class="script-line clinician"
         data-en="<em>“How would you like to feel in that future situation <span class='output placeholder' data-input-id='future-situation'>(Specify future situation)</span>?”</em>"
         data-uk="<em>«Як би ви хотіли почуватися в тій майбутній ситуації <span class='output placeholder' data-input-id='future-situation'>(Вкажіть майбутню ситуацію)</span>?»</em>">
        <em>“How would you like to feel in that future situation <span class="output placeholder" data-input-id="future-situation">(Specify future situation)</span>?”</em>
      </p>

      <div class="input-wrapper">
        <label for="desired-feeling" data-en="Desired Feeling / State in Future Situation" data-uk="Бажане почуття / Стан у майбутній ситуації">Desired Feeling / State in Future Situation</label>
        <input type="text" id="desired-feeling"
          data-en-placeholder="e.g., Calm, In control, Present..."
          data-uk-placeholder="напр., Спокій, Контроль, Присутність…"
          placeholder="e.g., Calm, In control, Present...">
      </div>

      <p class="script-line"
         data-en="PC (Future): <strong class='output placeholder' data-input-id='pc-for-future'>(PC for future will appear here)</strong>"
         data-uk="ПП (Майбутнє): <strong class='output placeholder' data-input-id='pc-for-future'>(ПП для майбутнього з'явиться тут)</strong>">
        PC (Future): <strong class="output placeholder" data-input-id="pc-for-future">(PC for future will appear here)</strong>
      </p>
      <p class="script-line"
         data-en="Desired Feeling/State: <strong class='output placeholder' data-input-id='desired-feeling'>(Desired feeling will appear here)</strong>"
         data-uk="Бажане почуття/Стан: <strong class='output placeholder' data-input-id='desired-feeling'>(Бажане почуття з'явиться тут)</strong>">
        Desired Feeling/State: <strong class="output placeholder" data-input-id="desired-feeling">(Desired feeling will appear here)</strong>
      </p>
    </div>
  </div>

  <div class="script-tool-section" id="step2-section">
    <div class="script-step">
      <h3 data-en="Step 2: Virtual Reality Experience of the Future Scene" data-uk="Крок 2: Досвід майбутньої сцени у віртуальній реальності">Step 2: Virtual Reality Experience of the Future Scene</h3>
      <h4 data-en="Clinician Note:" data-uk="Примітка для клініциста:">Clinician Note:</h4>
      <p class="script-line"
         data-en="Ask client to imagine the future scene in VR while holding the relevant PC and desired feeling."
         data-uk="Попросіть клієнта уявити майбутню сцену у ВР, тримаючи відповідне ПП та бажане почуття.">
        Ask client to imagine the future scene in VR while holding the relevant PC and desired feeling.
      </p>

      <p class="script-line clinician"
         data-en="<em>“I’d like you to imagine yourself responding effectively to this situation (<span class='output placeholder' data-input-id='future-situation'>(Specify future situation)</span>). With the positive belief '<span class='output placeholder' data-input-id='pc-for-future'>(PC for future)</span>' and a feeling of '<span class='output placeholder' data-input-id='desired-feeling'>(Desired feeling)</span>', imagine stepping into this scene in the VR environment. Notice how you are handling the situation and what you are thinking, feeling, and experiencing in your body.”</em>"
         data-uk="<em>«Я б хотів, щоб ви уявили, як ефективно реагуєте на цю ситуацію (<span class='output placeholder' data-input-id='future-situation'>(Вкажіть майбутню ситуацію)</span>). З позитивним переконанням '<span class='output placeholder' data-input-id='pc-for-future'>(ПП для майбутнього)</span>' і почуттям '<span class='output placeholder' data-input-id='desired-feeling'>(Бажане почуття)</span>', уявіть, як ви входите в цю сцену у ВР-середовищі. Зверніть увагу, як ви справляєтеся з ситуацією, і що ви думаєте, відчуваєте та переживаєте у своєму тілі».</em>">
        <em>“I’d like you to imagine yourself responding effectively to this situation
          (<span class="output placeholder" data-input-id="future-situation">(Specify future situation)</span>).
          With the positive belief '<span class="output placeholder" data-input-id="pc-for-future">(PC for future)</span>' and a feeling of
          '<span class="output placeholder" data-input-id="desired-feeling">(Desired feeling)</span>', imagine stepping into this scene in the VR environment. Notice how you are handling the situation and what you are thinking, feeling, and experiencing in your body.”</em>
      </p>
      <p class="script-line" data-en="[Pause sufficiently.]" data-uk="[Зробіть достатню паузу.]">[Pause sufficiently.]</p>
      <p class="script-line clinician" data-en="<em>“What are you noticing?”</em>" data-uk="<em>«Що ви помічаєте?»</em>"><em>“What are you noticing?”</em></p>

      <table class="response-table">
        <thead>
          <tr>
            <th data-en="IF RESPONSE IS NEGATIVE/UNCERTAIN" data-uk="ЯКЩО ВІДПОВІДЬ НЕГАТИВНА/НЕВИЗНАЧЕНА">IF RESPONSE IS NEGATIVE/UNCERTAIN</th>
            <th data-en="IF RESPONSE IS POSITIVE" data-uk="ЯКЩО ВІДПОВІДЬ ПОЗИТИВНА">IF RESPONSE IS POSITIVE</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <p class="script-line" data-en="Reprocess directly." data-uk="Переробіть безпосередньо.">Reprocess directly.</p>
              <p class="script-line clinician"
                 data-en="<em>“Okay, let's stay with that. Notice that.”</em> [Add sets of fast tactile/auditory BLS with client reports between sets until neutral. If blocked, refer to 'Blocked Processing' steps.]"
                 data-uk="<em>«Добре, залишимося з цим. Помітьте це».</em> [Додайте набори швидкого тактильного/слухового BLS зі звітами клієнта між наборами до нейтрального стану. Якщо заблоковано, зверніться до кроків 'Заблокована обробка'.]">
                <em>“Okay, let's stay with that. Notice that.”</em> [Add sets of fast tactile/auditory BLS with client reports between sets until neutral. If blocked, refer to 'Blocked Processing' steps.]
              </p>
            </td>
            <td>
              <p class="script-line" data-en="Reinforce and Install PC." data-uk="Підсильте та встановіть ПП.">Reinforce and Install PC.</p>
              <p class="script-line clinician"
                 data-en="<em>“Good. Hold onto that positive image/feeling.”</em> [Strengthen with fast tactile/auditory BLS (1-2 sets).]"
                 data-uk="<em>«Добре. Тримайтеся за цей позитивний образ/почуття».</em> [Підсильте швидким тактильним/слуховим BLS (1-2 набори).]">
                <em>“Good. Hold onto that positive image/feeling.”</em> [Strengthen with fast tactile/auditory BLS (1-2 sets).]
              </p>
              <p class="script-line clinician"
                 data-en="<em>“Now, bring up the future situation <span class='output placeholder' data-input-id='future-situation'>(Specify future situation)</span> and those words '<span class='output placeholder' data-input-id='pc-for-future'>(PC for future)</span>'. From 1 (completely false) to 7 (completely true), how true do they feel to you now?”</em>"
                 data-uk="<em>«Тепер уявіть майбутню ситуацію <span class='output placeholder' data-input-id='future-situation'>(Вкажіть майбутню ситуацію)</span> і ці слова '<span class='output placeholder' data-input-id='pc-for-future'>(ПП для майбутнього)</span>'. Від 1 (повністю неправда) до 7 (повністю правда), наскільки правдивими вони вам здаються зараз?»</em>">
                <em>“Now, bring up the future situation <span class="output placeholder" data-input-id="future-situation">(Specify future situation)</span> and those words '<span class="output placeholder" data-input-id="pc-for-future">(PC for future)</span>'. From 1 (completely false) to 7 (completely true), how true do they feel to you now?”</em>
              </p>
              <p class="script-line" data-en="[Install PC to VOC=7 using standard Installation protocol with BLS.]" data-uk="[Встановіть ПП до VOC=7 за стандартним протоколом Встановлення з BLS.]">[Install PC to VOC=7 using standard Installation protocol with BLS.]</p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Collapsible Step 3 -->
  <div class="script-tool-section" id="step3-section">
    <div class="script-step">
      <h3 data-en="Step 3: Generate a Challenging Situation within VR (Optional)" data-uk="Крок 3: Створити проблемну ситуацію в ВР (необов'язково)">Step 3: Generate a Challenging Situation within VR (Optional)</h3>
      <div class="collapsible-trigger">
        <input type="checkbox" id="toggle-step3" checked data-target="#step3-content">
        <label for="toggle-step3" data-en-hide="Hide Step 3 Details" data-uk-hide="Сховати деталі Кроку 3" data-en-show="Show Step 3 Details" data-uk-show="Показати деталі Кроку 3">Hide Step 3 Details</label>
      </div>
      <div class="collapsible-content is-expanded" id="step3-content">
        <h4 data-en="Clinician Note:" data-uk="Примітка для клініциста:">Clinician Note:</h4>
        <p class="script-line"
           data-en="Only when appropriate for the client. Create a realistic challenge within the VR scene. Process and install PC to VOC=7 for the challenge."
           data-uk="Тільки коли це доречно для клієнта. Створіть реалістичний виклик у ВР-сцені. Обробіть та встановіть ПП до VOC=7 для виклику.">
          Only when appropriate for the client. Create a realistic challenge within the VR scene. Process and install PC to VOC=7 for the challenge.
        </p>

        <p class="script-line clinician"
           data-en="<em>“Now we are going to introduce a potential challenge within the VR environment related to <span class='output placeholder' data-input-id='future-situation'>(Specify future situation)</span>. I want you to imagine yourself responding effectively to this challenge. Keep in mind the positive belief '<span class='output placeholder' data-input-id='pc-for-future'>(PC for future)</span>' and the desired feeling '<span class='output placeholder' data-input-id='desired-feeling'>(Desired feeling)</span>'. Here comes the scenario [Clinician describes or triggers the challenge element in VR, e.g., hearing sirens, seeing something specific].”</em>"
           data-uk="<em>«Тепер ми представимо потенційний виклик у ВР-середовищі, пов'язаний з <span class='output placeholder' data-input-id='future-situation'>(Вкажіть майбутню ситуацію)</span>. Я хочу, щоб ви уявили, як ефективно реагуєте на цей виклик. Пам'ятайте про позитивне переконання '<span class='output placeholder' data-input-id='pc-for-future'>(ПП для майбутнього)</span>' та бажане почуття '<span class='output placeholder' data-input-id='desired-feeling'>(Бажане почуття)</span>'. Ось сценарій [Клініцист описує або запускає елемент виклику у ВР, наприклад, звук сирен, побачити щось конкретне]».</em>">
          <em>“Now we are going to introduce a potential challenge within the VR environment related to
            <span class="output placeholder" data-input-id="future-situation">(Specify future situation)</span>. I want you to imagine yourself responding effectively to this challenge. Keep in mind the positive belief '<span class="output placeholder" data-input-id="pc-for-future">(PC for future)</span>' and the desired feeling '<span class="output placeholder" data-input-id="desired-feeling">(Desired feeling)</span>'. Here comes the scenario […].”</em>
        </p>
        <p class="script-line"
           data-en="[Implement Step 2 logic (Imagine scene, check response, reprocess or reinforce/install) for the <strong>challenge</strong> within the future situation.]"
           data-uk="[Застосуйте логіку Кроку 2 (Уявіть сцену, перевірте реакцію, переробіть або підсильте/встановіть) для <strong>виклику</strong> у межах майбутньої ситуації.]">
          [Implement Step 2 logic (Imagine scene, check response, reprocess or reinforce/install) for the <strong>challenge</strong> within the future situation.]
        </p>
      </div>
    </div>
  </div>

  <div class="script-tool-section" id="step4-section">
    <div class="script-step">
      <h3 data-en="Step 4: Run a Movie (Without VR Headset)" data-uk="Крок 4: Запустіть фільм (без гарнітури VR)">Step 4: Run a Movie (Without VR Headset)</h3>
      <h4 data-en="Clinician Note:" data-uk="Примітка для клініциста:">Clinician Note:</h4>
      <p class="script-line"
         data-en="Ask client to run a mental movie of the sequence adaptively, after removing the headset."
         data-uk="Попросіть клієнта програти уявний фільм послідовності адаптивно, після зняття гарнітури.">
        Ask client to run a mental movie of the sequence adaptively, after removing the headset.
      </p>

      <p class="script-line clinician"
         data-en="<em>“Now for this next part, you can please remove the VR headset. I would like you to run a movie from beginning to end dealing effectively with this situation (<span class='output placeholder' data-input-id='future-situation'>(Specify future situation)</span>, including any challenges we addressed), holding in mind the positive belief '<span class='output placeholder' data-input-id='pc-for-future'>(PC for future)</span>' and noticing the positive feelings like '<span class='output placeholder' data-input-id='desired-feeling'>(Desired feeling)</span>' and sensations. Let me know when you get to the end of the movie or if you bump into any disturbance or difficulty.”</em>"
         data-uk="<em>«Тепер для цієї наступної частини, будь ласка, зніміть VR-шолом. Я б хотів, щоб ви переглянули фільм від початку до кінця, ефективно справляючись із цією ситуацією (<span class='output placeholder' data-input-id='future-situation'>(Вкажіть майбутню ситуацію)</span>, включаючи будь-які виклики, які ми розглянули), пам’ятаючи про позитивне переконання '<span class='output placeholder' data-input-id='pc-for-future'>(ПП для майбутнього)</span>' і помічаючи позитивні почуття, такі як '<span class='output placeholder' data-input-id='desired-feeling'>(Бажане почуття)</span>', та відчуття. Дайте мені знати, коли дійдете до кінця фільму, або якщо ви зіткнетеся з будь-якими перешкодами чи труднощами».</em>">
        <em>“Now for this next part, you can please remove the VR headset. I would like you to run a movie from beginning to end dealing effectively with this situation
          (<span class="output placeholder" data-input-id="future-situation">(Specify future situation)</span>, including any challenges we addressed),
          holding in mind the positive belief '<span class="output placeholder" data-input-id="pc-for-future">(PC for future)</span>' and noticing the positive feelings like
          '<span class="output placeholder" data-input-id="desired-feeling">(Desired feeling)</span>' and sensations. Let me know when you get to the end of the movie or if you bump into any disturbance or difficulty.”</em>
      </p>
      <p class="script-line" data-en="[Once client signals completion:]" data-uk="[Коли клієнт повідомляє про завершення:]">[Once client signals completion:]</p>
      <p class="script-line clinician" data-en="<em>“What are you noticing?”</em>" data-uk="<em>«Що ви помічаєте?»</em>"><em>“What are you noticing?”</em></p>

      <table class="response-table">
        <thead>
          <tr>
            <th data-en="IF RESPONSE IS NEGATIVE/UNCERTAIN" data-uk="ЯКЩО ВІДПОВІДЬ НЕГАТИВНА/НЕВИЗНАЧЕНА">IF RESPONSE IS NEGATIVE/UNCERTAIN</th>
            <th data-en="IF RESPONSE IS POSITIVE" data-uk="ЯКЩО ВІДПОВІДЬ ПОЗИТИВНА">IF RESPONSE IS POSITIVE</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>
              <p class="script-line" data-en="Reprocess directly." data-uk="Переробіть безпосередньо.">Reprocess directly.</p>
              <p class="script-line clinician"
                 data-en="<em>“Okay, let's stay with that. Notice that.”</em> [Add sets of long/fast BLS (any modality) with client reports between sets until neutral. If blocked, refer to 'Blocked Processing'.]"
                 data-uk="<em>«Добре, залишимося з цим. Помітьте це».</em> [Додайте набори довгого/швидкого BLS (будь-яка модальність) зі звітами клієнта між наборами до нейтрального стану. Якщо заблоковано, зверніться до 'Заблокована обробка'.]">
                <em>“Okay, let's stay with that. Notice that.”</em> [Add sets of long/fast BLS (any modality) with client reports between sets until neutral. If blocked, refer to 'Blocked Processing'.]
              </p>
            </td>
            <td>
              <p class="script-line" data-en="Strengthen." data-uk="Підсильте.">Strengthen.</p>
              <p class="script-line clinician"
                 data-en="<em>“Good. Run that movie again.”</em> [Add BLS (any modality) while client runs the movie again.]"
                 data-uk="<em>«Добре. Перегляньте цей фільм ще раз».</em> [Додайте BLS (будь-яка модальність), поки клієнт знову переглядає фільм.]">
                <em>“Good. Run that movie again.”</em> [Add BLS (any modality) while client runs the movie again.]
              </p>
              <p class="script-line clinician" data-en="<em>“What are you noticing?”</em>" data-uk="<em>«Що ви помічаєте?»</em>"><em>“What are you noticing?”</em></p>
              <p class="script-line"
                 data-en="[IF NEUTRAL/POSITIVE]: Proceed to Installation (if needed)."
                 data-uk="[ЯКЩО НЕЙТРАЛЬНО/ПОЗИТИВНО]: Перейдіть до Встановлення (за потреби).">
                [IF NEUTRAL/POSITIVE]: Proceed to Installation (if needed).
              </p>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- Collapsible Installation -->
  <div class="script-tool-section" id="installation-section">
    <div class="script-step">
      <h3 data-en="Installation (Only if needed after Step 4 Movie)" data-uk="Встановлення (Тільки за потреби після Кроку 4 - Фільм)">Installation (Only if needed after Step 4 Movie)</h3>
      <div class="collapsible-trigger">
        <input type="checkbox" id="toggle-installation" checked data-target="#installation-content">
        <label for="toggle-installation" data-en-hide="Hide Installation Details" data-uk-hide="Сховати деталі встановлення" data-en-show="Show Installation Details" data-uk-show="Показати деталі встановлення">Hide Installation Details</label>
      </div>
      <div class="collapsible-content is-expanded" id="installation-content">
        <h4 data-en="Clinician Note:" data-uk="Примітка для клініциста:">Clinician Note:</h4>
        <p class="script-line"
           data-en="Only necessary if VOC < 7 after the positive movie run."
           data-uk="Необхідно тільки якщо VOC < 7 після позитивного перегляду фільму.">
          Only necessary if VOC < 7 after the positive movie run.
        </p>

        <p class="script-line clinician"
           data-en="<em>“Bring up the future situation (<span class='output placeholder' data-input-id='future-situation'>(Specify future situation)</span>) and those words '<span class='output placeholder' data-input-id='pc-for-future'>(PC for future)</span>'. From 1 (completely false) to 7 (completely true), how true do they feel to you now?”</em>"
           data-uk="<em>«Уявіть майбутню ситуацію (<span class='output placeholder' data-input-id='future-situation'>(Вкажіть майбутню ситуацію)</span>) і ці слова '<span class='output placeholder' data-input-id='pc-for-future'>(ПП для майбутнього)</span>'. Від 1 (повністю неправда) до 7 (повністю правда), наскільки правдивими вони вам здаються зараз?»</em>">
          <em>“Bring up the future situation (<span class="output placeholder" data-input-id="future-situation">(Specify future situation)</span>) and those words '<span class="output placeholder" data-input-id="pc-for-future">(PC for future)</span>'. From 1 (completely false) to 7 (completely true), how true do they feel to you now?”</em>
        </p>

        <p class="script-line" data-en="[IF VOC < 7]:" data-uk="[ЯКЩО VOC < 7]:">[IF VOC < 7]:</p>
        <p class="script-line clinician"
           data-en="<em>&nbsp;&nbsp;“Hold the situation and the words '<span class='output placeholder' data-input-id='pc-for-future'>(PC for future)</span>' together.”</em> [Apply BLS (any)]"
           data-uk="<em>&nbsp;&nbsp;«Тримайте ситуацію і слова '<span class='output placeholder' data-input-id='pc-for-future'>(ПП для майбутнього)</span>' разом».</em> [Застосуйте BLS (будь-яка)]">
          &nbsp;&nbsp;<em>“Hold the situation and the words '<span class="output placeholder" data-input-id="pc-for-future">(PC for future)</span>' together.”</em> [Apply BLS (any)]
        </p>
        <p class="script-line clinician"
           data-en="<em>&nbsp;&nbsp;“Let it go... take a breath... What are you noticing now? (pause) Notice that.”</em> [Apply BLS (any)]"
           data-uk="<em>&nbsp;&nbsp;«Відпустіть... зробіть вдих... Що ви помічаєте зараз? (пауза) Помітьте це».</em> [Застосуйте BLS (будь-яка)]">
          &nbsp;&nbsp;<em>“Let it go... take a breath... What are you noticing now? (pause) Notice that.”</em> [Apply BLS (any)]
        </p>
        <p class="script-line" data-en="&nbsp;&nbsp;[Check VOC, add sets of BLS until VOC no longer strengthens.]" data-uk="&nbsp;&nbsp;[Перевіряйте VOC, додайте серії BLS, доки VOC більше не підвищується.]">&nbsp;&nbsp;[Check VOC, add sets of BLS until VOC no longer strengthens.]</p>
        <p class="script-line clinician"
           data-en="<em>&nbsp;&nbsp;“Bring up the future situation (<span class='output placeholder' data-input-id='future-situation'>(Specify future situation)</span>) and those words '<span class='output placeholder' data-input-id='pc-for-future'>(PC for future)</span>'. From 1 to 7, how true do they feel now?”</em>"
           data-uk="<em>&nbsp;&nbsp;«Уявіть майбутню ситуацію (<span class='output placeholder' data-input-id='future-situation'>(Вкажіть майбутню ситуацію)</span>) і ці слова '<span class='output placeholder' data-input-id='pc-for-future'>(ПП для майбутнього)</span>'. Від 1 до 7, наскільки правдивими вони вам здаються зараз?»</em>">
          &nbsp;&nbsp;<em>“Bring up the future situation (<span class="output placeholder" data-input-id="future-situation">(Specify future situation)</span>) and those words '<span class="output placeholder" data-input-id="pc-for-future">(PC for future)</span>'. From 1 to 7, how true do they feel now?”</em>
        </p>
        <p class="script-line" data-en="&nbsp;&nbsp;[Once VOC=7 (or ecological max), add one more set of BLS and elicit feedback.]" data-uk="&nbsp;&nbsp;[Коли VOC=7 (або екологічний максимум), додайте ще одну серію BLS і зберіть відгук.]">&nbsp;&nbsp;[Once VOC=7 (or ecological max), add one more set of BLS and elicit feedback.]</p>
      </div>
    </div>
  </div>

  <div class="script-tool-section" id="blocked-section">
    <div class="script-step">
      <h3 data-en="Guidance: If Future Template Becomes Blocked" data-uk="Інструкція: Якщо Майбутній шаблон блокується">Guidance: If Future Template Becomes Blocked</h3>
      <div class="collapsible-trigger">
        <input type="checkbox" id="toggle-blocked" checked data-target="#blocked-content">
        <label for="toggle-blocked" data-en-hide="Hide Blocked Processing Guidance" data-uk-hide="Сховати інструкцію щодо заблокованої обробки" data-en-show="Show Blocked Processing Guidance" data-uk-show="Показати інструкцію щодо заблокованої обробки">Hide Blocked Processing Guidance</label>
      </div>
      <div class="collapsible-content is-expanded" id="blocked-content">
        <h4 data-en="Clinician Note:" data-uk="Примітка для клініциста:">Clinician Note:</h4>
        <p class="script-line" data-en="Address blocks appropriately." data-uk="Вирішуйте блокування належним чином.">Address blocks appropriately.</p>
        <ul>
          <li class="script-line"
              data-en="If related to hesitancy, skills deficit: Identify difficulty, problem-solve, teach skills, strengthen resources. Return to Future Template."
              data-uk="Якщо пов'язано з ваганнями, дефіцитом навичок: Визначте труднощі, вирішіть проблему, навчіть навичок, зміцніть ресурси. Поверніться до Майбутнього шаблону.">
            If related to hesitancy, skills deficit: Identify difficulty, problem-solve, teach skills, strengthen resources. Return to Future Template.
          </li>
          <li class="script-line"
              data-en="If another trigger emerges: Reprocess with Phases 3-6, then return to Future Template."
              data-uk="Якщо з'являється інший тригер: Переробіть за допомогою Фаз 3-6, потім поверніться до Майбутнього шаблону.">
            If another trigger emerges: Reprocess with Phases 3-6, then return to Future Template.
          </li>
          <li class="script-line"
              data-en="If Feeder Memory / Blocking Belief suspected: Reprocess using Phases 3-6. Identify/reprocess related Present Trigger, then return to Future Template."
              data-uk="Якщо підозрюється Спогад-джерело / Блокуюче переконання: Переробіть за допомогою Фаз 3-6. Визначте/переробіть пов'язаний Теперішній тригер, потім поверніться до Майбутнього шаблону.">
            If Feeder Memory / Blocking Belief suspected: Reprocess using Phases 3-6. Identify/reprocess related Present Trigger, then return to Future Template.
          </li>
        </ul>
      </div>
    </div>
  </div>

  <div class="script-tool-section" id="closure-section">
    <div class="script-step">
      <h3 data-en="Closure Reminder" data-uk="Нагадування про закриття">Closure Reminder</h3>
      <h4 data-en="Clinician Note:" data-uk="Примітка для клініциста:">Clinician Note:</h4>
      <p class="script-line" data-en="Use standard Closure (Phase 7) procedures at the end of every session." data-uk="Використовуйте стандартні процедури Закриття (Фаза 7) в кінці кожної сесії.">Use standard Closure (Phase 7) procedures at the end of every session.</p>
    </div>
  </div>

  <div id="copy-section">
    <div id="copy-message" aria-live="polite"></div>
    <button id="copy-script-button" class="copy-button" data-en="Copy Full Script" data-uk="Копіювати весь скрипт">Copy Full Script</button>
  </div>
</div>

<script>
(() => {
  const contentRoot = document.getElementById('manual-content') || document;
  const $  = (sel, root = contentRoot) => root.querySelector(sel);
  const $$ = (sel, root = contentRoot) => Array.from(root.querySelectorAll(sel));
  const getLang = () => (document.documentElement.lang || 'en').toLowerCase().startsWith('uk') ? 'uk' : 'en';

  // Inputs
  const presentTriggerInput            = $('#present-trigger');
  const positiveCognitionInput         = $('#positive-cognition');
  const pcStatusSelect                 = $('#pc-status');
  const newPcInputGroup                = $('#new-pc-input-group');
  const newPositiveCognitionSelect     = $('#new-positive-cognition-select');
  const newPositiveCognitionOtherInput = $('#new-positive-cognition-other');
  const futureSituationInput           = $('#future-situation');
  const desiredFeelingInput            = $('#desired-feeling');

  const copyButton  = $('#copy-script-button');
  const copyMessage = $('#copy-message');

  const getOutputSpans = () => $$('.output');

  // Localized default strings
  const defaults = {
    'present-trigger': {
      en: '(Specify reprocessed present trigger)',
      uk: '(Вкажіть перероблений теперішній тригер)'
    },
    'positive-cognition': {
      en: '(Specify PC from present trigger)',
      uk: '(Вкажіть ПП з теперішнього тригера)'
    },
    'future-situation': {
      en: '(Specify future situation)',
      uk: '(Вкажіть майбутню ситуацію)'
    },
    'desired-feeling': {
      en: '(Specify desired feeling)',
      uk: '(Вкажіть бажане почуття)'
    },
    'new-pc-select': {
      en: '(Select or specify New PC)',
      uk: '(Оберіть або вкажіть нове ПП)'
    },
    'new-pc-other': {
      en: '(Specify custom New PC)',
      uk: '(Вкажіть власне нове ПП)'
    }
  };
  const d = (key) => defaults[key][getLang()];

  // --- Bilingual PC Catalog (stable IDs) ---
  const pcCatalog = [
    {
      id: 'CAT_DEFECT',
      en: 'RESPONSIBILITY: DEFECTIVENESS / Self-Worth/Shame',
      uk: 'ВІДПОВІДАЛЬНІСТЬ: ДЕФЕКТНІСТЬ / Самоцінність/сором',
      items: [
        { id:'PC_GOOD', en:'I am good.',                               uk:'Я хороший(а).' },
        { id:'PC_LOVABLE', en:'I am lovable.',                          uk:'Я гідний(на) любові.' },
        { id:'PC_ENOUGH', en:'I am good enough.',                       uk:'Я достатньо хороший(а).' },
        { id:'PC_COMPETENT', en:'I am competent.',                      uk:'Я компетентний(на).' },
        { id:'PC_MATTER', en:'I do matter.',                            uk:'Я маю значення.' },
        { id:'PC_NOT_MY_FAULT', en:"It's not my fault. (I'm innocent)", uk:'Це не моя вина. (Я невинний/невинна).' },
      ]
    },
    {
      id: 'CAT_ACTION',
      en: 'RESPONSIBILITY: ACTION / Action/Guilt',
      uk: 'ВІДПОВІДАЛЬНІСТЬ: ДІЇ / Дія/провина',
      items: [
        { id:'PC_LEARN', en:'I learned/can learn from it.',             uk:'Я навчився/можу навчитися з цього.' },
        { id:'PC_BEST', en:'I did the best I could.',                   uk:'Я зробив(ла) все, що міг(могла).' },
        { id:'PC_FORGIVE', en:'I can forgive myself and move on.',      uk:'Я можу пробачити себе і рухатися далі.' },
        { id:'PC_OKAY', en:"I'm okay, in spite of my mistake.",         uk:'Зі мною все гаразд, попри мою помилку.' },
        { id:'PC_STRONG', en:'I am adequate/strong.',                   uk:'Я достатній(ня), сильний(на).' },
      ]
    },
    {
      id: 'CAT_SAFETY',
      en: 'SAFETY / VULNERABILITY',
      uk: 'БЕЗПЕКА / УРАЗЛИВІСТЬ',
      items: [
        { id:'PC_PROTECT', en:'I can (learn to) protect myself.',       uk:'Я можу (навчуся) захищати себе.' },
        { id:'PC_SURVIVED', en:'I survived.',                           uk:'Я вижив(ла).' },
        { id:'PC_SAFE_NOW', en:'I am safe now.',                        uk:'Я зараз у безпеці.' },
        { id:'PC_TRUST_WHOM', en:'I can choose whom to trust.',         uk:'Я можу обирати, кому довіряти.' },
        { id:'PC_OVER', en:"It's over, I can move beyond it.",          uk:'Це позаду, я можу рухатися далі.' },
      ]
    },
    {
      id: 'CAT_CONTROL',
      en: 'CONTROL / CHOICES',
      uk: 'КОНТРОЛЬ / ВИБІР',
      items: [
        { id:'PC_CHOICES_NOW', en:'I have choices now.',                uk:'Зараз у мене є вибір.' },
        { id:'PC_FREE', en:"I'm free.",                                 uk:'Я вільний(на).' },
        { id:'PC_CONTROL_NOW', en:"I'm in control now.",                uk:'Зараз я контролюю ситуацію.' },
        { id:'PC_HANDLE', en:'I can handle it.',                        uk:'Я впораюся.' },
        { id:'PC_CONTROL_REACT', en:"I'm in control of my reactions.",  uk:'Я контролюю свої реакції.' },
        { id:'PC_TRUST_SELF', en:'I can (learn to) trust myself/my judgment.', uk:'Я можу (навчуся) довіряти собі/своєму судженню.' },
      ]
    },
    {
      id: 'CAT_CONNECTION',
      en: 'CONNECTION / BELONGING',
      uk: 'ЗВ’ЯЗОК / НАЛЕЖНІСТЬ',
      items: [
        { id:'PC_CONNECT', en:'I can connect/I am connected.',          uk:'Я можу встановлювати зв’язок / Я пов’язаний(на).' },
        { id:'PC_BELONG', en:'I do belong/I worthy of belonging.',      uk:'Я належу / Я гідний(на) належати.' },
        { id:'PC_SEEN', en:'I deserve to be seen.',                     uk:'Я заслуговую бути поміченим(ою).' },
        { id:'PC_UNIQUE', en:"I am myself/unique, & that's okay.",      uk:'Я — це я/унікальний(на), і це нормально.' },
        { id:'PC_NOT_ALONE', en:"I'm not alone. (I'm connected.)",      uk:'Я не сам(а). (Я пов’язаний(на) з іншими.)' },
      ]
    }
  ];

  // Build / rebuild the New PC select, preserving current selection
  function buildNewPcSelect(lang = getLang(), preserve = true){
    const sel = newPositiveCognitionSelect;
    if(!sel) return;

    const prev = preserve ? sel.value : '';

    // Clear
    while (sel.firstChild) sel.removeChild(sel.firstChild);

    // Default + Other
    const defOpt = document.createElement('option');
    defOpt.value = '';
    defOpt.setAttribute('data-en-label', 'Select PC...');
    defOpt.setAttribute('data-uk-label', 'Оберіть ПП...');
    defOpt.textContent = lang === 'uk' ? defOpt.getAttribute('data-uk-label') : defOpt.getAttribute('data-en-label');
    sel.appendChild(defOpt);

    const otherOpt = document.createElement('option');
    otherOpt.value = 'other';
    otherOpt.setAttribute('data-en-label', 'Other (Type below)');
    otherOpt.setAttribute('data-uk-label', 'Інше (введіть нижче)');
    otherOpt.textContent = lang === 'uk' ? otherOpt.getAttribute('data-uk-label') : otherOpt.getAttribute('data-en-label');
    sel.appendChild(otherOpt);

    // Categories & items
    pcCatalog.forEach(cat => {
      const og = document.createElement('optgroup');
      og.setAttribute('data-en-label', cat.en);
      og.setAttribute('data-uk-label', cat.uk);
      og.label = lang === 'uk' ? cat.uk : cat.en;

      cat.items.forEach(item => {
        const opt = document.createElement('option');
        opt.value = item.id; // stable ID
        opt.setAttribute('data-en-label', item.en);
        opt.setAttribute('data-uk-label', item.uk);
        opt.textContent = lang === 'uk' ? item.uk : item.en;
        og.appendChild(opt);
      });

      sel.appendChild(og);
    });

    // Restore selection if possible
    if (prev) {
      const hasPrev = Array.from(sel.options).some(o => o.value === prev);
      sel.value = hasPrev ? prev : '';
    }
  }

  // Sync input placeholders with language (do not touch existing values)
  function syncInputPlaceholders(){
    const lang = getLang();
    $$('input[data-en-placeholder], textarea[data-en-placeholder]').forEach(el => {
      const en = el.getAttribute('data-en-placeholder') || '';
      const uk = el.getAttribute('data-uk-placeholder') || en;
      el.setAttribute('placeholder', lang === 'uk' ? uk : en);
    });
  }

  // Compute current values (language-aware defaults & labels)
  function computeValues(){
    const lang = getLang();
    const pcFromPresent = (positiveCognitionInput?.value || '').trim() || d('positive-cognition');

    // Determine label for selected "new PC"
    let newPcSelected;
    if (!newPositiveCognitionSelect) {
      newPcSelected = d('new-pc-select');
    } else {
      const v = newPositiveCognitionSelect.value;
      if (v === 'other') {
        newPcSelected = (newPositiveCognitionOtherInput?.value || '').trim() || d('new-pc-other');
      } else if (!v) {
        newPcSelected = d('new-pc-select');
      } else {
        const opt = newPositiveCognitionSelect.querySelector(`option[value="${CSS.escape(v)}"]`);
        const label = opt ? (lang === 'uk' ? opt.getAttribute('data-uk-label') : opt.getAttribute('data-en-label')) : '';
        newPcSelected = label || d('new-pc-select');
      }
    }

    const pcStatus = pcStatusSelect?.value;
    const pcForFuture = pcStatus === 'new' ? newPcSelected : pcFromPresent;

    return {
      'present-trigger'       : (presentTriggerInput?.value || '').trim() || d('present-trigger'),
      'positive-cognition'    : pcFromPresent,
      'future-situation'      : (futureSituationInput?.value || '').trim() || d('future-situation'),
      'desired-feeling'       : (desiredFeelingInput?.value || '').trim() || d('desired-feeling'),
      'new-positive-cognition': newPcSelected,
      'pc-for-future'         : pcForFuture
    };
  }

  function updateOutputSpans(){
    const values = computeValues();
    getOutputSpans().forEach(span => {
      const key = span.dataset.inputId;
      if(!key) return;
      const newValue = values[key];
      const isPlaceholder = !newValue || newValue.startsWith('(');
      span.textContent = newValue || `(${(key || '').replace(/-/g,' ') || 'value'})`;
      span.classList.toggle('placeholder', isPlaceholder);
    });
  }

  function syncPcControls(){
    if (pcStatusSelect && newPcInputGroup) {
      const showGroup = pcStatusSelect.value === 'new';
      newPcInputGroup.style.display = showGroup ? 'block' : 'none';
      if (!showGroup && newPositiveCognitionOtherInput) newPositiveCognitionOtherInput.value = '';
    }
    if (newPositiveCognitionSelect && newPositiveCognitionOtherInput) {
      const showOther = newPositiveCognitionSelect.value === 'other';
      newPositiveCognitionOtherInput.style.display = showOther ? 'block' : 'none';
      if (!showOther) newPositiveCognitionOtherInput.value = '';
    }
  }

  // Collapsibles
  function initCollapsibles(){
    $$('.collapsible-trigger').forEach(triggerDiv => {
      const checkbox = triggerDiv.querySelector('input[type="checkbox"]');
      const label    = triggerDiv.querySelector('label');
      const targetId = checkbox?.dataset.target || '';
      const content  = document.getElementById(targetId.replace(/^#/, ''));

      const setLabel = () => {
        const lang = getLang();
        const showAttr = lang === 'uk' ? 'data-uk-show' : 'data-en-show';
        const hideAttr = lang === 'uk' ? 'data-uk-hide' : 'data-en-hide';
        const showTxt  = label?.getAttribute(showAttr) || (lang === 'uk' ? 'Показати деталі' : 'Show Details');
        const hideTxt  = label?.getAttribute(hideAttr) || (lang === 'uk' ? 'Сховати деталі' : 'Hide Details');
        if (label && checkbox) label.textContent = checkbox.checked ? hideTxt : showTxt;
      };

      if (checkbox && label && content){
        content.classList.toggle('is-expanded', checkbox.checked);
        setLabel();
        checkbox.addEventListener('change', () => {
          content.classList.toggle('is-expanded', checkbox.checked);
          setLabel();
        });
        document.addEventListener('languageChanged', setLabel);
      }
    });
  }

  // Copy script
  function initCopy(){
    if (!copyButton) return;

    const setButtonLabel = () => {
      const lang = getLang();
      copyButton.textContent = copyButton.getAttribute(lang === 'uk' ? 'data-uk' : 'data-en') ||
                               (lang === 'uk' ? 'Копіювати весь скрипт' : 'Copy Full Script');
    };
    setButtonLabel();
    document.addEventListener('languageChanged', setButtonLabel);

    copyButton.addEventListener('click', () => {
      let out = '';
      const mainTitle = $('#tool-main-heading');
      if (mainTitle) out += `# ${mainTitle.textContent.trim()} #\n\n`;

      $$('.script-tool-section').forEach(section => {
        const triggerDiv = section.querySelector('.collapsible-trigger');
        const contentDiv = section.querySelector('.collapsible-content');

        if (triggerDiv && contentDiv) {
          for (const node of section.childNodes) {
            if (node === triggerDiv || node === contentDiv) break;
            out += nodeToText(node);
          }
          if (contentDiv.classList.contains('is-expanded')) {
            for (const node of contentDiv.childNodes) out += nodeToText(node);
          }
        } else {
          for (const node of section.childNodes) out += nodeToText(node);
        }
        out += '\n---\n';
      });

      const ta = document.createElement('textarea');
      ta.value = out.replace(/---(\s*---)+/g, '---').trim();
      ta.style.position = 'fixed'; ta.style.opacity = '0';
      document.body.appendChild(ta);
      ta.select();
      let ok = false;
      try { ok = document.execCommand('copy'); } catch(e){}
      document.body.removeChild(ta);

      const lang = getLang();
      if (ok) {
        if (copyMessage) copyMessage.textContent = lang === 'uk' ? 'Скопійовано!' : 'Copied!';
        copyButton.classList.add('copied');
      } else {
        if (copyMessage) copyMessage.textContent = lang === 'uk' ? 'Помилка копіювання' : 'Copy failed';
      }
      setTimeout(() => {
        if (copyMessage) copyMessage.textContent = '';
        copyButton.classList.remove('copied');
        setButtonLabel();
      }, 2000);
    });

    function nodeToText(node){
      if (node.nodeType === Node.TEXT_NODE) return node.textContent?.trim() ? node.textContent : '';
      if (node.nodeType !== Node.ELEMENT_NODE) return '';

      const el = node;
      if (el.classList?.contains('input-wrapper') || el.classList?.contains('collapsible-trigger')) return '';

      if (el.tagName === 'H3') {
        const m = el.textContent.match(/Step\s+(\d+):/i);
        return m ? `\n## Step ${m[1]} ##\n` : `\n## ${el.textContent.trim()} ##\n`;
      }
      if (el.tagName === 'H4') {
        let s = `\n**${el.textContent.trim()}**\n`;
        let nxt = el.nextElementSibling;
        while (nxt && !/^H[1-6]$/.test(nxt.tagName) &&
               !nxt.classList?.contains('input-wrapper') &&
               !nxt.classList?.contains('collapsible-trigger')) {
          s += elementTextWithOutputs(nxt) + '\n';
          nxt = nxt.nextElementSibling;
        }
        return s;
      }

      if (el.classList?.contains('response-table')) {
        let s = '\n';
        el.querySelectorAll('tr').forEach((row, i) => {
          let rowText = '';
          row.querySelectorAll('th,td').forEach(cell => {
            const t = elementTextWithOutputs(cell).split('\n').map(l => `  ${l.trim()}`).join('\n').trim();
            rowText += (i === 0 ? `[ ${t} ]\t` : `${t}\n`);
          });
          s += rowText.trim() + '\n';
          if (i === 0) s += '\n';
        });
        s += '\n';
        return s;
      }

      if (el.tagName === 'UL') {
        return Array.from(el.querySelectorAll('li')).map(li => `- ${elementTextWithOutputs(li)}`).join('\n') + '\n';
      }

      if (el.classList?.contains('script-line') || el.tagName === 'P' || el.tagName === 'LI') {
        return elementTextWithOutputs(el) + '\n';
      }

      if (el.tagName === 'DIV' || el.classList?.contains('script-step')) {
        return Array.from(el.childNodes).map(nodeToText).join('');
      }

      return '';
    }

    function elementTextWithOutputs(el){
      if (/^(TABLE|THEAD|TBODY|TR|TH|TD)$/.test(el.tagName)) {
        return (el.textContent || '').replace(/\s+/g, ' ').trim();
      }
      if (el.tagName === 'UL') {
        return Array.from(el.querySelectorAll('li'))
          .map(li => `- ${elementTextWithOutputs(li)}`).join('\n');
      }

      let text = '';
      el.childNodes.forEach(n => {
        if (n.nodeType === Node.TEXT_NODE) text += n.textContent;
        else if (n.nodeType === Node.ELEMENT_NODE) {
          const ne = n;
          if (ne.classList?.contains('output')) {
            const vals = computeValues();
            const key = ne.dataset.inputId;
            text += (key && vals[key]) ? vals[key] : ne.textContent;
          } else if (!ne.classList?.contains('input-wrapper') &&
                     !ne.classList?.contains('collapsible-trigger') &&
                     !ne.classList?.contains('collapsible-content') &&
                     !/^(INPUT|TEXTAREA|SELECT|LABEL|TABLE|THEAD|TBODY|TR|TH|TD)$/.test(ne.tagName)) {
            text += elementTextWithOutputs(ne);
          }
        }
      });
      return text.replace(/\s+/g, ' ').trim();
    }
  }

  // Input events
  [
    presentTriggerInput, positiveCognitionInput, pcStatusSelect,
    newPositiveCognitionSelect, newPositiveCognitionOtherInput,
    futureSituationInput, desiredFeelingInput
  ].forEach(el => {
    if (!el) return;
    el.addEventListener('input', () => { syncPcControls(); updateOutputSpans(); });
    if (el.tagName === 'SELECT') el.addEventListener('change', () => { syncPcControls(); updateOutputSpans(); });
  });

  // Collapsibles & Copy
  initCollapsibles();
  initCopy();

  // Rebuild bilingual New PC select on load & on language change
  buildNewPcSelect(getLang(), /*preserve*/ false);

  // Re-sync on language changes from header.js
  document.addEventListener('languageChanged', () => {
    buildNewPcSelect(getLang(), /*preserve*/ true);
    syncInputPlaceholders();
    syncPcControls();
    updateOutputSpans();
  });

  // Initial state
  syncInputPlaceholders();
  syncPcControls();
  updateOutputSpans();
})();
</script>
